## 書いてる人リスト
- 凡例
入学年度 名前(ニックネーム可)
  - 自己紹介などあれば

2022 田巻春輔
- C++20を使っている。去年一昨年の制御班がいなかった。だからコードの汚さとかはちょっと大目に見てほしい(修正削除依頼はじゃんじゃんしてほしい)

## ディレクトリ構成
**C++のモジュールが十分に使えるようになった場合やC++以外のものを使うようになった場合は変更すること**  
モジュールが使えるならヘッダとかほぼ要らないんじゃないかな...  
ケーススタイルはなるべく下に合わせてほしい。  

```
Module :
{
	Module ... (opt)  // モジュールの中の機能をさらに細分化する場合はこのようにする
	not_module_directory (opt) ...  // モジュールでないディレクトリはsnake_caseで
	module_specific_file ...  // ファイル名はsnake_caseで
}
```
Moduleの例
```
Config :
{
	include
	{
		config.hpp
	}
}

// 他にもSampleとか
```
not_module_directoryの例
```
include
{
	a.hpp
	b.hpp
}

src
{
	c.cpp
	d.cpp
}
```
module_specific_fileの例
```
memo.md
```

C++ソースファイルのみからインクルードされるヘッダファイルの拡張子は.hpp、Cソースファイルからインクルードされうるヘッダファイルの拡張子は.hとすること。

## コーディング規約
### 空白
単項演算子前には空白は入れない。二項演算子であり中置記法の演算子は基本的に空白もしくは改行を入れる。
ただし```.```や```->```は両端ともに入れない。```,```は右にのみ入れる。
例:
```
a + b
a, b
a.b
```

### ケーススタイル
あるエンティティの制約となるものはPascalCase, 制約とはみなしにくいものはsnake_caseで書いていることが多い。  
そうでないこともある。  

### 改行・インデント
波括弧の位置は自由だ。  
インデントはタブを使う。  
式や文の途中で改行した場合は、基本的にインデントの後ろに空白を一つ入れる。  
  
**如何なる制御文の括弧の後ろにも、インデントを入れてはならない。**  
```
if(/*...*/)
	hoge_func();
```
このような書き方は絶対にしないこと。  
(如何なる文の後ろにもと書いたが全部の文を把握しているかと言われると怪しいので、矛盾を見つけたり意見がある場合は教えてほしい)  
改行を入れないのは良しとする。そうでもなきゃ```else if(/**/)```とか書けないし。ただし、マクロによる思わぬ挙動には気を付けること。  

### マクロ

**マクロを使うな。**  

基本的には(inlineで)constexprな変数で代用できるはずだ。#define PI 3.14...とか絶対ダメ。(πはそもそもstd::numbers::piとかあるし)  
どうしても使いたい場合...コピペ三昧しかけたときとか...は使ってもよいものとする。  
ケーススタイルは問わない。ただし、  
**#undefを忘れないこと。**
#undefしないマクロがある場合は[命名](#naming)を参照のこと。

<a id="naming"></a>

### 命名
定数は先頭にkを付ける人もいるかもしれないし、メンバは_から始める人もいるかもしれない。  
基本自由だ。たくさん書いてもみんな守らないだろうし。俺は守らないぞ。 

ただし、C++の規格は守ってもらう。  
**_ + 大文字から始まる識別子(identifier)はC++ではどの文脈でも使ってはならない。2つ続く_を含む識別子もダメだ。また、_ + 小文字から始まるグローバル名前空間下の名前も予約されている。**  
それから、名前の衝突もさけなければならない。  
**グローバル名前空間上の名前はstew_から始めること。**  
(stew_である必要はない。俺がstewだからstewにしてただけだ。変えたいなら一括で変えてくれ)  
また、stew_から始まる名前と衝突しないか必ず意識すること。そもそもむやみにグローバル名前空間にものを増やすのは良くない。

その上で、こうするといいんじゃないかなという提案を書く。
- 可能な限り意味のある名前を付ける  
```auto tmp```とか```template<class T>```とか```bool flag```とか、なるべく使わない。可能ならそれにふさわしい名前を付ける。  
(例外的にコンセプトのテンプレート引数はTにしても良いと思う(あれは任意の型を受け付けるものだから))
- なるべく省略しない  
ひとまとまりの単語は5文字までは省略しないようにしようよ。timじゃなくてtimer、cntじゃなくてcountとか...  
省略したくなったら```using```や参照を使おう。
- 翻訳ツールを使う  
マジでピッタリの名前が見つかるかも？deeplいいぞ(2022年現在)
- 無駄な情報を入れない  
```CanFrame::CanHeader```とか、```student.student_id```とか書かずに、```CanFrame::Header```とか、```student.id```とか書くべきだと思う。  
名前空間も有効活用しよう。上の例だと```namespace Can{ Frame::Header }```のほうがいいかもしれない。  
\*Infoや\*Type、\*Dataなんて名前も注意しよう。これらを除いても十分に意味がはっきりしていることが多い。  
- 英語に注意  
initialisationとかindexsとか書くと笑われるかも。俺、indexsは正義だと思うけどな...
- CRSLibのユーザーに見せる必要のない名前はその名前空間内の名前空間Implementに入れる
- そのファイルでしか使わない名前はImplementの中のそのファイル名+Impの名前空間の中に入れる
こうするとコード補完が見やすくなるし、どこを読めばいいかもわかりやすくなると思う。

### その他
- **ソースファイルでexternは絶対に使うな**  
  あ、```extern "C"```のことじゃないよ。  
  基本、ヘッダにない名前は使われないことを想定されている。つまり、使ってほしくないんだ。  
  だから、それらの名前を使うことは書き手の意図に反しているということになる。危険だ。  
  そういうことがしたくなったら、まずはコードを書いた人に連絡してほしい。  

  これはつまり、exetrnをユーザーに書かせるようなコードは原則ダメってことだ。  
  (ST社は各ハンドルを何故ヘッダに宣言してないんだ...?)  

  最近だとヘッダのexternも多くの場合はinlineで対応できる。なるべくinline変数を使うべきだと思う。
- pragma onceは使ってもいい  
  規格に無いものだけど便利だし...。インクルードガードがコード補完に現れることもなくなるしね。
- constexprは市民の義務  
  らしい。https://en.cppreference.com/w/cpp/language/constexpr  
  (C++のバージョンによってできることが大きく変わるので、cpprefjpより各バージョンの違いがわかりやすいcpprefのがおすすめ)
- ヘッダの依存関係はなるべくわかりやすく  
  そのファイルで使われている名前が書かれているヘッダはインクルードする、というのがおすすめ  
  ただし、ある名前の導入されているヘッダAがヘッダB中でプロプロセッサなどによりインクルードするのを制御されてたりしたら、そのBをインクルードする。  

  あ、a.cppに必要なヘッダを全てa.hppでインクルードしろ、というのには俺は反対だ。  
  それじゃファイルを分けた意味が薄まっちゃうからね。  
- sourcetrailで依存関係を確認する
  ~~わかりやすいよ～~~どうもC++20のコードが誤ってエラーと認識されるようだ。アテにできない...

<!-- ### 最後に
**書いたコードには責任を持つこと。**  
少なくともそう心がけること。  

自戒でもあるが。  

書いたコードは当然、使われる。自身によって、自分の同期によって、後輩によって、もしかしたら全く知らない誰かによって。  
もしコードにバグがあったら、ロボットが暴走するかもしれない。そして誰かがケガしたり、場合によっては大きな事故になるかもしれない。  

法的責任を負えとは言わない。だが、自分が適当に書いたコードで誰かが傷つけばきっととっても辛い。  
頑張ってコードを書いてくれた人にそのような思いはしてほしくない。  

2022年現在、C++コードは簡単に未定義動作を起こす。バグを全く含まないコードを書けというのはきっと無理な話だろう。  
だが、「自分は真摯にコードを書いている」という自負があれば、何かあってもちょっとはマシな心持ちになれると思うのだ。  

「動けばいい」という思想は時間的余裕の少ない我々大学サークルにとっては素晴らしいものだが、危険なものでもあるということを忘れないでほしい。  
せめて「これはもしかしたらバグるかもだけど、この安全装置があるから十分に安全、大丈夫」など、適当に作ったしわ寄せは必ずどこかで解決しよう。 -->